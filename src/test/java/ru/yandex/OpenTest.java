package ru.yandex;

import io.qameta.allure.Description;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import org.openqa.selenium.WebElement;
import ru.open.PageOpen;


public class OpenTest extends ru.WebDriverSettings {

    @Test
    @Description(value = "Тест Open.ru обмена валюты с шагами")
    public void checkOpenWithSteps() {
        System.out.println(this.getClass().getName());
        PageObjectYandexSearch yandexSearch = new PageObjectYandexSearch(chromeDriver);
        Steps.searchTextYandex(yandexSearch, "Открытие");
    }


    @Test
    @Description(value = "Тест Open.ru обмена валюты")
    public void checkOpenPageObject() throws InterruptedException {
        System.out.println(this.getClass().getName());

        PageObjectYandexSearch yandexSearch = new PageObjectYandexSearch(chromeDriver);
        PageOpen openRu = new PageOpen(chromeDriver);

        yandexSearch.find("Открытие");
        yandexSearch.waitPagerItems();

        boolean check = false;
        String openRuLink = "";
        for(WebElement we : yandexSearch.getListOfAllLinks()) {
            if (we.getAttribute("href").contains("https://www.open.ru")) {
                check = true;
                openRuLink = we.getAttribute("href");
                break;
            }
        }
        Assertions.assertTrue(check, "No 'https://www.open.ru' on page");

        chromeDriver.get(openRuLink);
        chromeDriver.manage().deleteAllCookies();

        WebElement exchangeBlock = openRu.getExchangeBlock();
        float buyDollar = openRu.getBuyUSD(exchangeBlock);
        float sellDollar = openRu.getSellUSD(exchangeBlock);

        System.out.println("Buy="+buyDollar);
        System.out.println("Sell="+sellDollar);

        Assertions.assertTrue(sellDollar > buyDollar, "sellDollar less than buyDollar");

    }

}
